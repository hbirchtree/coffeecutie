language: cpp
dist: trusty
services:
 - docker

os:
 - linux
 #- osx
compiles:
 - clang

env:
  matrix:
   - BUILDVARIANT=ubuntu.amd64
   - BUILDVARIANT=android.armv7a
   - BUILDVARIANT=android.armv8a
   - BUILDVARIANT=fedora.amd64
   - BUILDVARIANT=maemo.armv7a
   - BUILDVARIANT=raspberry.armhf
   - BUILDVARIANT=steam.amd64
   - BUILDVARIANT=emscripten.asmjs
   - BUILDVARIANT=emscripten.wasm
   - BUILDVARIANT=ubuntu.i686
   - BUILDVARIANT=osx
   - BUILDVARIANT=ios

matrix:
  exclude:
  - os: linux
    env: BUILDVARIANT=osx
  - os: linux
    env: BUILDVARIANT=ios
  - os: osx
    env: BUILDVARIANT=ubuntu.amd64
  - os: osx
    env: BUILDVARIANT=android.armv7a
  - os: osx
    env: BUILDVARIANT=android.armv8a
  - os: osx
    env: BUILDVARIANT=fedora.amd64
  - os: osx
    env: BUILDVARIANT=maemo.armv7a
  - os: osx
    env: BUILDVARIANT=raspberry.armhf
  - os: osx
    env: BUILDVARIANT=steam.amd64
  - os: osx
    env: BUILDVARIANT=emscripten.asmjs
  - os: osx
    env: BUILDVARIANT=emscripten.wasm
  - os: osx
    env: BUILDVARIANT=ubuntu.i686

before_script:
 - ci/travis-deps.sh

script:
 - ci/travis-build.sh

notifications:
  email: true

branches:
  only:
   - master
   - /^testing.*$/

deploy:
  provider: releases
  api_key: "${GITHUB_TOKEN}"
  file: "libraries_$BUILDVARIANT.tar.gz"
  skip_cleanup: true
  on:
    tags: true
