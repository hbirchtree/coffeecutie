# Updating MODULE_VERSION
string(TIMESTAMP BUILDTIME "%y%m%d%H")

# git tag + commit + working tree state
execute_process(
  COMMAND git describe --tags --dirty
  OUTPUT_VARIABLE GIT_TAG
  WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
)

string ( REPLACE "\n" "" GIT_TAG "${GIT_TAG}" )

set ( MODULE_VERSION "${GIT_TAG}_${BUILDTIME}" )

message ( STATUS "Writing version ${MODULE_VERSION}" )

file ( WRITE "@VERSION_FILE@"
    "#define MODULE_VERSION \"${MODULE_VERSION}\"\n"
    )
