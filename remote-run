#!/bin/bash

TARGET=$1
TARGET_FILE=${TARGET_FILE:-/tmp/$RANDOM.elf}
EXEC_FILE=$(realpath $2)
ARGS=${@:3}
PORT=${PORT:-22}

scp -P $PORT $EXEC_FILE $TARGET:$TARGET_FILE
ssh -o SendEnv=COFFEE_REPORT_URL -p $PORT $TARGET -t -- $TARGET_FILE $ARGS
ssh -p $PORT $TARGET -t -- rm $TARGET_FILE
