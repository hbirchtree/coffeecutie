set ( CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/tests )

if(BUILD_COVERAGE)
    set ( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -O0 -fprofile-arcs -ftest-coverage" )
    set ( CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -g -O0 -fprofile-arcs -ftest-coverage" )
    if(CMAKE_COMPILER_IS_GNUCXX)
        set ( CMAKE_EXE_LINKER_FLAGS_DEBUG "${CMAKE_EXE_LINKER_FLAGS_DEBUG} --coverage" )
    elseif("${CMAKE_CXX_COMPILER_ID}" MATCHES "Clang")
        set ( CMAKE_EXE_LINKER_FLAGS_DEBUG "${CMAKE_EXE_LINKER_FLAGS_DEBUG} --coverage" )
    endif()
endif()

add_subdirectory(cmd-api)
add_subdirectory(datastorage-api)
add_subdirectory(file-api)
add_subdirectory(function-tests)
add_subdirectory(math-logic)
add_subdirectory(profiling-api)
add_subdirectory(size-tests)
add_subdirectory(string-api)
add_subdirectory(sysinfo-api)
if(NOT EMSCRIPTEN)
    add_subdirectory(thread-api)
endif()

if(NOT SKIP_LINKAGE_TEST)
    add_subdirectory(link-api)
endif()
#if(COFFEE_BUILD_OPENVR AND NOT SKIP_OPENVR_TEST)
#    add_subdirectory(vr-api)
#endif()

# This needs different testing and setup
if(NOT ANDROID AND NOT WIN32)
    # Known to not work with:
    #  - Android (limitations in ant buildtool? thinks it's invalid)
    #  - Windows (just plain terrible filename encoding)
    add_subdirectory(packaging-api)
endif()

